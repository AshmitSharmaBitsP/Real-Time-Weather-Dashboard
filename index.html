<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/weather-icon.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta
      name="description"
      content="Beautiful weather dashboard with current conditions and 5-day forecast"
    />
    <meta
      name="keywords"
      content="weather, forecast, dashboard, vue, tailwind"
    />

    <!-- Preconnect to external domains -->
    <link rel="preconnect" href="https://api.openweathermap.org" />
    <link rel="preconnect" href="https://openweathermap.org" />

    <!-- Google Fonts - Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <title>Weather Dashboard - Vue.js & Tailwind CSS</title>

    <!-- Tailwind CSS CDN (for StackBlitz compatibility) -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
      /* Loading spinner */
      .loading-container {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 9999;
      }

      .spinner {
        width: 50px;
        height: 50px;
        border: 4px solid rgba(255, 255, 255, 0.3);
        border-top: 4px solid white;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      /* Dynamic Weather Backgrounds */
      .weather-clear {
        background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
      }

      .weather-sunny {
        background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
      }

      .weather-clouds {
        background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        background: linear-gradient(135deg, #e0c3fc 0%, #9bb5ff 100%);
      }

      .weather-rain {
        background: linear-gradient(135deg, #4b6cb7 0%, #182848 100%);
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .weather-storm {
        background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
        background: linear-gradient(135deg, #232526 0%, #414345 100%);
      }

      .weather-snow {
        background: linear-gradient(135deg, #e6ddd4 0%, #d5dee7 100%);
        background: linear-gradient(135deg, #cfd9df 0%, #e2ebf0 100%);
      }

      .weather-mist {
        background: linear-gradient(135deg, #bdc3c7 0%, #2c3e50 100%);
        background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
      }

      .weather-night {
        background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
        background: linear-gradient(135deg, #000428 0%, #004e92 100%);
      }

      /* Font family for the entire app */
      body {
        font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI',
          Roboto, sans-serif;
      }

      /* Custom scrollbar */
      ::-webkit-scrollbar {
        width: 8px;
        height: 8px;
      }

      ::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.1);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb {
        background: rgba(255, 255, 255, 0.3);
        border-radius: 4px;
      }

      ::-webkit-scrollbar-thumb:hover {
        background: rgba(255, 255, 255, 0.5);
      }

      /* Hide loading once app loads */
      .app-loaded .loading-container {
        display: none;
      }

      /* Weather-specific text colors */
      .weather-snow .text-white {
        color: #2c3e50 !important;
      }

      .weather-snow .text-white\/80 {
        color: rgba(44, 62, 80, 0.8) !important;
      }

      .weather-snow .text-white\/70 {
        color: rgba(44, 62, 80, 0.7) !important;
      }
    </style>
  </head>
  <body>
    <!-- Loading Screen -->
    <div class="loading-container" id="loading">
      <div class="text-center">
        <div class="spinner mb-4"></div>
        <p class="text-white text-lg">Loading Weather Dashboard...</p>
      </div>
    </div>

    <!-- Vue App Container -->
    <div id="app"></div>

    <!-- Vue 3 CDN (for StackBlitz compatibility) -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>

    <script type="module">
      // Simple app loading handler
      window.addEventListener('load', () => {
        setTimeout(() => {
          document.body.classList.add('app-loaded');
        }, 1000);
      });

      // Vue app inline for StackBlitz
      const { createApp, ref, computed, onMounted } = Vue;

      // Mock weather service for demo
      const weatherService = {
        async getCurrentWeather(city) {
          // Simulate API delay
          await new Promise((resolve) => setTimeout(resolve, 1000));

          // Special case for Tokyo - make it rainy
          if (city.toLowerCase() === 'tokyo') {
            return {
              name: 'Tokyo',
              sys: {
                country: 'JP',
                sunrise: Math.floor(Date.now() / 1000) - 3600,
                sunset: Math.floor(Date.now() / 1000) + 3600,
              },
              main: {
                temp: 18 + Math.random() * 5,
                feels_like: 16 + Math.random() * 5,
                temp_min: 15 + Math.random() * 3,
                temp_max: 22 + Math.random() * 3,
                pressure: 1008 + Math.random() * 10,
                humidity: 75 + Math.random() * 15,
              },
              weather: [
                {
                  main: 'Rain',
                  description: 'light rain',
                  icon: '10d',
                },
              ],
              wind: { speed: 4 + Math.random() * 3 },
              visibility: 6000 + Math.random() * 2000,
              dt: Math.floor(Date.now() / 1000),
            };
          }

          // Default sunny weather for other cities
          return {
            name: city,
            sys: {
              country: 'XX',
              sunrise: Math.floor(Date.now() / 1000) - 3600,
              sunset: Math.floor(Date.now() / 1000) + 3600,
            },
            main: {
              temp: 15 + Math.random() * 20,
              feels_like: 13 + Math.random() * 20,
              temp_min: 10 + Math.random() * 10,
              temp_max: 20 + Math.random() * 10,
              pressure: 1000 + Math.random() * 50,
              humidity: 50 + Math.random() * 40,
            },
            weather: [
              {
                main: 'Clear',
                description: 'clear sky',
                icon: '01d',
              },
            ],
            wind: { speed: 2 + Math.random() * 8 },
            visibility: 8000 + Math.random() * 2000,
            dt: Math.floor(Date.now() / 1000),
          };
        },

        async getForecast(city) {
          await new Promise((resolve) => setTimeout(resolve, 800));

          return {
            list: Array.from({ length: 40 }, (_, i) => ({
              dt: Math.floor(Date.now() / 1000) + i * 3 * 3600,
              main: {
                temp: 15 + Math.random() * 10 - 5,
                humidity: 60 + Math.random() * 30,
              },
              weather: [
                {
                  main: 'Clear',
                  description: 'clear sky',
                  icon: ['01d', '02d', '03d', '04d', '09d', '10d'][
                    Math.floor(Math.random() * 6)
                  ],
                },
              ],
              wind: { speed: 2 + Math.random() * 5 },
              pop: Math.random() * 0.5,
            })),
          };
        },
      };

      // Main App Component
      const App = {
        setup() {
          const weatherData = ref(null);
          const forecastData = ref(null);
          const loading = ref(false);
          const error = ref(null);
          const searchQuery = ref('');
          const currentWeatherTheme = ref('weather-clear');

          const popularCities = [
            'London',
            'Tokyo',
            'New York',
            'Paris',
            'Sydney',
            'Mumbai',
          ];

          const dailyForecast = computed(() => {
            if (!forecastData.value) return [];

            const daily = {};
            forecastData.value.list.forEach((item) => {
              const date = new Date(item.dt * 1000).toDateString();
              if (!daily[date]) {
                daily[date] = {
                  date: item.dt * 1000,
                  temp_min: item.main.temp,
                  temp_max: item.main.temp,
                  icon: item.weather[0].icon,
                  description: item.weather[0].description,
                  humidity: item.main.humidity,
                  wind_speed: item.wind.speed,
                  pop: Math.round(item.pop * 100),
                };
              } else {
                daily[date].temp_min = Math.min(
                  daily[date].temp_min,
                  item.main.temp
                );
                daily[date].temp_max = Math.max(
                  daily[date].temp_max,
                  item.main.temp
                );
              }
            });
            return Object.values(daily).slice(0, 5);
          });

          const todayHourly = computed(() => {
            if (!forecastData.value) return [];
            const today = new Date().toDateString();
            return forecastData.value.list
              .filter(
                (item) => new Date(item.dt * 1000).toDateString() === today
              )
              .slice(0, 8);
          });

          const formatHour = (timestamp) => {
            return new Date(timestamp * 1000).toLocaleTimeString('en-US', {
              hour: 'numeric',
              hour12: true,
            });
          };

          const handleSearch = async (city) => {
            loading.value = true;
            error.value = null;

            try {
              const [current, forecast] = await Promise.all([
                weatherService.getCurrentWeather(city),
                weatherService.getForecast(city),
              ]);

              weatherData.value = current;
              forecastData.value = forecast;

              // Update theme based on current weather
              if (current.weather && current.weather[0]) {
                currentWeatherTheme.value = getWeatherTheme(
                  current.weather[0].main,
                  current.weather[0].icon
                );
              }
            } catch (err) {
              error.value = err.message || 'Failed to fetch weather data';
              weatherData.value = null;
              forecastData.value = null;
            } finally {
              loading.value = false;
            }
          };

          const submitSearch = () => {
            if (searchQuery.value.trim() && !loading.value) {
              handleSearch(searchQuery.value.trim());
            }
          };

          const selectCity = (city) => {
            searchQuery.value = city;
            handleSearch(city);
          };

          const formatTime = (timestamp) => {
            return new Date(timestamp * 1000).toLocaleTimeString('en-US', {
              hour: '2-digit',
              minute: '2-digit',
              hour12: true,
            });
          };

          const formatDay = (timestamp) => {
            const date = new Date(timestamp);
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);

            if (date.toDateString() === today.toDateString()) {
              return 'Today';
            } else if (date.toDateString() === tomorrow.toDateString()) {
              return 'Tomorrow';
            } else {
              return date.toLocaleDateString('en-US', { weekday: 'short' });
            }
          };

          const getWeatherTheme = (weatherMain, weatherIcon) => {
            const hour = new Date().getHours();
            const isNight = hour < 6 || hour > 20;

            // Check if it's night time first
            if (isNight) {
              return 'weather-night';
            }

            // Daytime weather themes
            switch (weatherMain.toLowerCase()) {
              case 'clear':
                return 'weather-sunny';
              case 'clouds':
                return 'weather-clouds';
              case 'rain':
              case 'drizzle':
                return 'weather-rain';
              case 'thunderstorm':
                return 'weather-storm';
              case 'snow':
                return 'weather-snow';
              case 'mist':
              case 'fog':
              case 'haze':
              case 'smoke':
                return 'weather-mist';
              default:
                return 'weather-clear';
            }
          };

          onMounted(() => {
            handleSearch('London');
          });

          return {
            weatherData,
            forecastData,
            loading,
            error,
            searchQuery,
            popularCities,
            dailyForecast,
            todayHourly,
            currentWeatherTheme,
            handleSearch,
            submitSearch,
            selectCity,
            formatTime,
            formatDay,
            formatHour,
            getWeatherTheme,
          };
        },

        template: `
          <div class="min-h-screen transition-all duration-1000 ease-in-out" :class="currentWeatherTheme">
            <div class="container mx-auto px-4 py-8">
              <!-- Header -->
              <header class="text-center mb-8">
                <h1 class="text-4xl md:text-6xl font-bold text-white mb-2 drop-shadow-lg">
                  Weather Dashboard
                </h1>
                <p class="text-xl text-white/80 drop-shadow-md">
                  Get real-time weather information for any city
                </p>
              </header>

              <!-- Search Bar -->
              <div class="max-w-md mx-auto mb-8">
                <form @submit.prevent="submitSearch" class="flex">
                  <input
                    v-model="searchQuery"
                    type="text"
                    placeholder="Enter city name..."
                    class="flex-1 px-6 py-4 text-lg rounded-l-full bg-white/20 backdrop-blur-sm text-white placeholder-white/70 border-none outline-none focus:bg-white/30 focus:ring-2 focus:ring-white/50 transition-all duration-300"
                    :disabled="loading"
                  />
                  <button
                    type="submit"
                    :disabled="loading || !searchQuery.trim()"
                    class="px-8 py-4 bg-white/30 hover:bg-white/40 disabled:bg-white/10 disabled:cursor-not-allowed rounded-r-full backdrop-blur-sm transition-all duration-300 hover:scale-105"
                  >
                    <div v-if="loading" class="w-6 h-6 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                    <svg v-else class="w-6 h-6 text-white hover:scale-110 transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                  </button>
                </form>
                
                <!-- Popular Cities -->
                <div class="mt-6">
                  <p class="text-white/80 text-sm text-center mb-3 font-medium">Popular Cities:</p>
                  <div class="flex flex-wrap justify-center gap-2">
                    <button
                      v-for="city in popularCities"
                      :key="city"
                      @click="selectCity(city)"
                      :disabled="loading"
                      class="px-4 py-2 text-sm bg-white/20 hover:bg-white/30 disabled:bg-white/10 text-white rounded-full backdrop-blur-sm transition-all duration-200 hover:scale-105 hover:shadow-lg font-medium"
                    >
                      {{ city }}
                    </button>
                  </div>
                </div>
              </div>

              <!-- Weather Display -->
              <div v-if="weatherData && !loading" class="space-y-8">
                <!-- Current Weather -->
                <div class="bg-white/20 backdrop-blur-md rounded-2xl p-8 shadow-2xl border border-white/20">
                  <div class="grid md:grid-cols-2 gap-8 items-center">
                    <div class="text-center md:text-left">
                      <h2 class="text-3xl font-bold text-white mb-4 drop-shadow-md">{{ weatherData.name }}, {{ weatherData.sys.country }}</h2>
                      
                      <div class="flex items-center justify-center md:justify-start mb-6">
                        <img 
                          :src="'https://openweathermap.org/img/wn/' + weatherData.weather[0].icon + '@2x.png'"
                          :alt="weatherData.weather[0].description"
                          class="w-20 h-20 mr-4 drop-shadow-lg"
                        />
                        <div>
                          <div class="text-6xl font-bold text-white drop-shadow-lg">{{ Math.round(weatherData.main.temp) }}¬∞</div>
                          <div class="text-xl text-white/80 capitalize font-medium drop-shadow-md">{{ weatherData.weather[0].description }}</div>
                        </div>
                      </div>

                      <div class="flex justify-center md:justify-start space-x-6 text-white/80">
                        <div class="text-center">
                          <div class="text-sm font-medium">Feels like</div>
                          <div class="text-lg font-semibold">{{ Math.round(weatherData.main.feels_like) }}¬∞</div>
                        </div>
                        <div class="text-center">
                          <div class="text-sm font-medium">High / Low</div>
                          <div class="text-lg font-semibold">{{ Math.round(weatherData.main.temp_max) }}¬∞ / {{ Math.round(weatherData.main.temp_min) }}¬∞</div>
                        </div>
                      </div>
                    </div>

                    <div class="grid grid-cols-2 gap-4">
                      <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 text-center hover:bg-white/20 transition-all duration-300 hover:scale-105 border border-white/10">
                        <div class="text-2xl mb-2">üí®</div>
                        <div class="text-white/70 text-sm mb-1 font-medium">Wind Speed</div>
                        <div class="text-white font-semibold text-lg">{{ weatherData.wind.speed }} m/s</div>
                      </div>
                      <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 text-center hover:bg-white/20 transition-all duration-300 hover:scale-105 border border-white/10">
                        <div class="text-2xl mb-2">üíß</div>
                        <div class="text-white/70 text-sm mb-1 font-medium">Humidity</div>
                        <div class="text-white font-semibold text-lg">{{ weatherData.main.humidity }}%</div>
                      </div>
                      <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 text-center hover:bg-white/20 transition-all duration-300 hover:scale-105 border border-white/10">
                        <div class="text-2xl mb-2">üîç</div>
                        <div class="text-white/70 text-sm mb-1 font-medium">Visibility</div>
                        <div class="text-white font-semibold text-lg">{{ (weatherData.visibility / 1000).toFixed(1) }} km</div>
                      </div>
                      <div class="bg-white/10 backdrop-blur-sm rounded-xl p-4 text-center hover:bg-white/20 transition-all duration-300 hover:scale-105 border border-white/10">
                        <div class="text-2xl mb-2">üå°Ô∏è</div>
                        <div class="text-white/70 text-sm mb-1 font-medium">Pressure</div>
                        <div class="text-white font-semibold text-lg">{{ weatherData.main.pressure }} hPa</div>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- 5-Day Forecast -->
                <div v-if="forecastData" class="bg-white/20 backdrop-blur-md rounded-2xl p-8 shadow-xl">
                  <h3 class="text-2xl font-bold text-white mb-6 text-center">5-Day Forecast</h3>
                  
                  <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
                    <div
                      v-for="day in dailyForecast"
                      :key="day.date"
                      class="bg-white/10 backdrop-blur-sm rounded-xl p-6 text-center hover:bg-white/20 transition-all duration-300 transform hover:scale-105"
                    >
                      <div class="text-white font-semibold mb-3">{{ formatDay(day.date) }}</div>

              </div>

              <!-- Error Message -->
              <div v-if="error" class="mt-8 bg-red-500/20 backdrop-blur-sm rounded-2xl p-6 text-center border border-red-400/30 shadow-xl">
                <div class="text-red-100 text-lg font-medium drop-shadow-sm">‚ö†Ô∏è {{ error }}</div>
              </div>

              <!-- Loading State -->
              <div v-if="loading" class="mt-8 text-center">
                <div class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-white drop-shadow-lg"></div>
                <p class="text-white mt-4 font-medium drop-shadow-sm">Loading weather data...</p>
              </div>
            </div>
          </div>
        `,
      };

      createApp(App).mount('#app');
    </script>
  </body>
</html>
